<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>üöÄ Metawinners Slot Machine</title>
<style>
  body {
    margin:0; background:radial-gradient(ellipse at center, #0a0014 0%, #000 100%);
    color:#fff; font-family:'Orbitron', sans-serif; text-align:center; overflow:hidden;
  }
  h1 { margin:20px; font-size:2.5em; color:#0ff; text-shadow:0 0 20px #0ff; }
  .reels { display:flex; justify-content:center; gap:20px; margin:20px; }
  .reel {
    width:100px; height:120px; border:3px solid #0ff; border-radius:12px;
    background:#111; display:flex; align-items:center; justify-content:center;
    font-size:60px; overflow:hidden; box-shadow:0 0 20px #0ff;
    transition:box-shadow 0.3s ease-in-out;
  }
  .reel img { max-width:80px; max-height:100px; object-fit:contain; }
  .reel.spinning {
    animation:glowPulse 1s infinite alternate;
  }
  
@keyframes glowPulse {
    from { box-shadow:0 0 10px #0ff, 0 0 20px #09f; }
    to   { box-shadow:0 0 30px #0ff, 0 0 60px #09f; }
  }
  button {
    padding:12px 28px; font-size:18px; margin:10px;
    background:linear-gradient(90deg,#0ff,#09f);
    color:#000; border:0; border-radius:10px; cursor:pointer;
    box-shadow:0 0 15px #0ff; transition:transform 0.1s;
  }
  button:active { transform:scale(0.95); }
  #result { margin:20px; font-size:24px; text-shadow:0 0 12px #fff; }
  #credits { font-size:20px; margin:10px; }
  #leaderboard {
    margin:20px auto; width:320px; background:rgba(0,255,255,0.1);
    border:1px solid #0ff; border-radius:12px; padding:10px; text-align:left;
  }
  #leaderboard h2 { text-align:center; color:#0ff; font-size:1.2em; }
  .stars { position:fixed; width:2px; height:2px; background:#0ff; animation:twinkle 5s infinite; opacity:0.8; }
  
@keyframes twinkle { 0%,100%{opacity:0.2;} 50%{opacity:1;} }
  #uploads { margin:20px; }
  #controls { margin:10px; }
  canvas#confettiCanvas {
    position:fixed; top:0; left:0; width:100%; height:100%;
    pointer-events:none; z-index:9999;
  }
  #footer {
    margin:30px 0;
    font-size:18px;
    color:#0ff;
    text-shadow:0 0 12px #0ff;
  }
</style>
</head>
<body>
  <h1>üöÄ Metawinners Slot üöÄ</h1>
  <div id="credits">Credits: <span id="creditValue">100</span></div>
  <div class="reels">
    <div class="reel" id="r0">üçí</div>
    <div class="reel" id="r1">üíé</div>
    <div class="reel" id="r2">7Ô∏è‚É£</div>
  </div>
  <div id="controls">
    <button id="spin">SPIN</button>
    <button id="addCredit">+10 Credits</button>
    <button id="mute">üîä Sound</button>
  </div>
  <div id="result"></div>

  <div id="uploads">
    <input type="file" id="nftUpload" accept="image/*" multiple>
    <p>Upload your MetaWinners NFT images to appear on the reels</p>
    <div id="nftPreview"></div>
  </div>

  <div id="leaderboard">
    <h2>üèÜ Leaderboard</h2>
    <ul id="lbList"></ul>
  </div>

  <div id="footer">Had fun? Come and play on <a href="https://MetaWin.com" target="_blank" style="color:#0ff;text-decoration:underline;">MetaWin.com</a></div>

  <!-- Confetti canvas -->
  <canvas id="confettiCanvas"></canvas>

<script>
let emojiSymbols = ["üçí","üíé","7Ô∏è‚É£","‚≠ê","üé≤","üõ∏","üöÄ","üëæ"];
let nftSymbols = JSON.parse(localStorage.getItem("mw_nfts")||"[]");
let reels = [document.getElementById("r0"), document.getElementById("r1"), document.getElementById("r2")];
let result = document.getElementById("result");
let creditValue = document.getElementById("creditValue");
let credits = parseInt(localStorage.getItem("mw_credits")||"100");
let leaderboard = JSON.parse(localStorage.getItem("mw_lb")||"[]");
let muted = false;

// preload sounds
const spinSound = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
const winSound = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
const jackpotSound = new Audio("https://actions.google.com/sounds/v1/ambiences/magic_chime.ogg");

function playSound(sound){ if(!muted){ sound.currentTime=0; sound.play(); } }

function updateCredits() {
  creditValue.textContent = credits;
  localStorage.setItem("mw_credits", credits);
}
function saveScore(username, score) {
  leaderboard.push({name:username, score});
  leaderboard.sort((a,b)=>b.score-a.score);
  leaderboard = leaderboard.slice(0,5);
  localStorage.setItem("mw_lb", JSON.stringify(leaderboard));
  renderLB();
}
function renderLB(){
  const ul=document.getElementById("lbList");
  ul.innerHTML="";
  leaderboard.forEach(e=>{
    const li=document.createElement("li");
    li.textContent = `${e.name}: ${e.score}`;
    ul.appendChild(li);
  });
}
function renderNFTs(){
  const preview=document.getElementById("nftPreview");
  preview.innerHTML="";
  nftSymbols.forEach(src=>{
    let img=document.createElement("img");
    img.src=src;
    img.style.width="60px";
    img.style.margin="5px";
    preview.appendChild(img);
  });
}
function getRandomSymbol(){
  let pool = [...emojiSymbols, ...nftSymbols, ...nftSymbols];
  return pool[Math.floor(Math.random()*pool.length)];
}
function displaySymbol(reel, sym){
  reel.innerHTML="";
  if(sym.startsWith("data:image")){
    let img=document.createElement("img");
    img.src=sym;
    reel.appendChild(img);
  } else {
    reel.textContent=sym;
  }
}
function spin(){
  if (credits<=0){ result.textContent="No credits left!"; return; }
  credits--; updateCredits();
  playSound(spinSound);

  reels.forEach(r=>r.classList.add("spinning"));

  let outcome=[];
  reels.forEach((reel,i)=>{
    let count=15; let frame=0;
    const interval=setInterval(()=>{
      let sym=getRandomSymbol();
      displaySymbol(reel,sym);
      frame++;
      if(frame>=count){
        clearInterval(interval);
        outcome[i]=sym;
        reel.classList.remove("spinning");
        if(i===reels.length-1) checkWin(outcome);
      }
    },100+50*i);
  });
}
function checkWin(outcome){
  if(outcome[0]===outcome[1] && outcome[1]===outcome[2]){
    result.textContent="‚ú® JACKPOT! ‚ú® +50 credits";
    credits+=50;
    playSound(jackpotSound);
    launchConfetti();
    const user=prompt("Enter your username for the leaderboard:","Anon"); 
    if(user) saveScore(user,credits);
  } else if(outcome[0]===outcome[1]||outcome[1]===outcome[2]||outcome[0]===outcome[2]){
    result.textContent="‚≠ê Pair win! +10 credits";
    credits+=10;
    playSound(winSound);
  } else {
    result.textContent="Try again."; 
  }
  updateCredits();
}
document.getElementById("spin").addEventListener("click",spin);
document.getElementById("addCredit").addEventListener("click",()=>{credits+=10;updateCredits();});
document.getElementById("mute").addEventListener("click",()=>{
  muted=!muted;
  document.getElementById("mute").textContent = muted ? "üîá Muted" : "üîä Sound";
});
document.getElementById("nftUpload").addEventListener("change",e=>{
  [...e.target.files].forEach(file=>{
    const reader=new FileReader();
    reader.onload=()=>{ nftSymbols.push(reader.result); localStorage.setItem("mw_nfts",JSON.stringify(nftSymbols)); renderNFTs(); };
    reader.readAsDataURL(file);
  });
});

updateCredits(); renderLB(); renderNFTs();

// starfield background
for(let i=0;i<120;i++){
  let s=document.createElement('div');
  s.className='stars';
  s.style.left=Math.random()*100+'vw';
  s.style.top=Math.random()*100+'vh';
  document.body.appendChild(s);
}

// CONFETTI SYSTEM
const canvas=document.getElementById("confettiCanvas");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;
let confettiParticles=[];

function ConfettiPiece(){
  this.x=Math.random()*canvas.width;
  this.y=Math.random()*-20;
  this.color=`hsl(${Math.random()*360},100%,50%)`;
  this.size=5+Math.random()*8;
  this.speed=2+Math.random()*5;
  this.angle=Math.random()*2*Math.PI;
  this.spin=0.05+Math.random()*0.05;
}
ConfettiPiece.prototype.update=function(){
  this.y+=this.speed;
  this.angle+=this.spin;
  if(this.y>canvas.height) this.y=-10;
}
ConfettiPiece.prototype.draw=function(){
  ctx.save();
  ctx.translate(this.x,this.y);
  ctx.rotate(this.angle);
  ctx.fillStyle=this.color;
  ctx.fillRect(-this.size/2,-this.size/2,this.size,this.size);
  ctx.restore();
}
function launchConfetti(){
  confettiParticles=[];
  for(let i=0;i<200;i++){ confettiParticles.push(new ConfettiPiece()); }
  let duration=3000;
  let start=Date.now();
  function animate(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    confettiParticles.forEach(p=>{p.update();p.draw();});
    if(Date.now()-start<duration) requestAnimationFrame(animate);
    else ctx.clearRect(0,0,canvas.width,canvas.height);
  }
  animate();
}
</script>
</body>
</html>
