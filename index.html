<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üöÄ MetaWin Epic Slots</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
<style>
  :root{
    --neon-a: #0ff;
    --neon-b: #09f;
    --bg: #000;
    --card: #111;
  }
  html,body{height:100%; margin:0;}
  body {
    margin:0;
    min-height:100%;
    background:var(--bg);
    color:#fff;
    font-family:'Orbitron',sans-serif;
    text-align:center;
    overflow:hidden;
  }

  /* animated star background */
  body::before{
    content:"";
    position:fixed; inset:0; z-index:-2;
    background-image: url('https://www.transparenttextures.com/patterns/stardust.png');
    opacity:0.25;
    animation: drift 120s linear infinite;
    mix-blend-mode:screen;
  }
  @keyframes drift{ from{background-position:0 0} to{background-position:5000px 5000px} }

  /* Splash */
  #splash{
    position:fixed; inset:0; z-index:9999;
    display:flex; align-items:center; justify-content:center; flex-direction:column;
    background: radial-gradient(circle at center, rgba(0,255,255,0.06), rgba(0,0,0,0.9));
    backdrop-filter: blur(6px);
  }
  #splash .title {
    font-size:clamp(2.4rem,7vw,5rem);
    color:var(--neon-a);
    text-shadow: 0 0 30px rgba(0,255,255,0.18), 0 0 80px rgba(0,150,255,0.06);
    margin:0 0 18px 0;
  }
  #splash .sub {
    margin-bottom:20px;
    font-size:clamp(1rem,2.2vw,1.35rem);
    color:#eaffff;
    opacity:0.95;
  }
  #enterGame {
    padding:14px 36px; border-radius:14px; border:0; cursor:pointer;
    font-size:1.2rem; background:linear-gradient(90deg,var(--neon-a),var(--neon-b));
    color:#010202; box-shadow:0 0 30px rgba(0,255,255,0.15);
  }

  header{ padding:18px 12px 4px 12px; display:flex; align-items:center; justify-content:center; gap:20px; flex-wrap:wrap; }
  header h1{ margin:0; font-size:clamp(1.6rem,4vw,2.6rem); color:var(--neon-a); text-shadow:0 0 18px rgba(0,255,255,0.25);}
  #credits{ color:#dff; font-size:clamp(0.9rem,1.8vw,1.1rem); margin-top:6px; background:rgba(0,255,255,0.02); padding:6px 10px; border-radius:10px; border:1px solid rgba(0,255,255,0.06); }

  .reel-wrap{
    display:flex; gap:clamp(16px,4vw,48px);
    justify-content:center; align-items:center;
    padding:20px; margin:8px;
    border-radius:20px;
    max-width:1200px; margin-left:auto; margin-right:auto;
    animation: framePulse 4s ease-in-out infinite alternate;
    border:3px solid rgba(0,255,255,0.05);
  }
  @keyframes framePulse{
    from{ box-shadow:0 0 28px rgba(0,255,255,0.06), inset 0 0 18px rgba(0,150,255,0.02); }
    to{ box-shadow:0 0 80px rgba(0,255,255,0.12), inset 0 0 40px rgba(0,150,255,0.03); }
  }

  .reel{
    flex:1 1 0;
    max-width:310px;
    aspect-ratio: 1 / 1.1;
    border-radius:18px;
    background:linear-gradient(180deg,var(--card),#0a0a0a);
    border:4px solid rgba(0,255,255,0.12);
    display:flex; align-items:center; justify-content:center;
    font-size:clamp(3rem,9vw,7rem);
    color:#fff; overflow:hidden; position:relative;
    box-shadow:0 10px 40px rgba(0,0,0,0.6), 0 0 40px rgba(0,255,255,0.04);
    transition:transform .18s ease, box-shadow .18s ease;
  }
  .reel img{ max-width:88%; max-height:88%; object-fit:contain; }
  .reel.spinning{ transform: translateY(-4px); animation: reelGlow 0.9s infinite alternate; }
  @keyframes reelGlow{ from{ box-shadow:0 20px 40px rgba(0,255,255,0.06);} to{ box-shadow:0 30px 120px rgba(0,150,255,0.15);} }

  #controls{ display:flex; gap:12px; justify-content:center; align-items:center; flex-wrap:wrap; margin-top:12px; }
  .btn{
    cursor:pointer; border-radius:12px; border:0; padding:12px 22px; font-size:1rem;
    background:linear-gradient(90deg,var(--neon-a),var(--neon-b)); color:#000;
    box-shadow: 0 6px 30px rgba(0,255,255,0.08); transition: transform .08s;
  }
  .btn:active{ transform:scale(.97); }

  #result{ margin-top:14px; min-height:1.2em; font-size:clamp(1rem,2vw,1.4rem); color:#eaffff; }

  #uploads{ margin:16px auto; max-width:760px; padding:10px; color:#cfe; text-align:center; }
  #nftPreview{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin-top:10px; }
  #nftPreview img{ width:72px; height:72px; object-fit:cover; border-radius:10px; border:2px solid rgba(0,255,255,0.06); }

  #leaderboard{ margin:18px auto; max-width:360px; background:rgba(0,255,255,0.02); padding:10px; border-radius:12px; border:1px solid rgba(0,255,255,0.04); color:#dff; }
  #leaderboard h2{ color:var(--neon-a); margin:6px 0 10px; font-size:1.1rem; }

  footer{ margin:24px 0 48px; color:var(--neon-a); font-size:0.95rem; }
  canvas#confettiCanvas{ position:fixed; inset:0; width:100%; height:100%; pointer-events:none; z-index:9998; }
</style>
</head>
<body>
  <div id="splash">
    <div class="title">üöÄ MetaWin ‚Äî Epic Slots</div>
    <div class="sub">Huge reels. Upload NFTs. Win big.</div>
    <button id="enterGame">Enter Game</button>
  </div>

  <header>
    <h1>üöÄ Metawinners Slot</h1>
    <div id="credits">Credits: <strong id="creditValue">100</strong></div>
  </header>

  <main>
    <div class="reel-wrap">
      <div class="reel" id="r0">üçí</div>
      <div class="reel" id="r1">üíé</div>
      <div class="reel" id="r2">7Ô∏è‚É£</div>
    </div>

    <div id="controls">
      <button class="btn" id="spin">SPIN</button>
      <button class="btn" id="addCredit">+10 Credits</button>
      <button class="btn" id="mute">üîä Sound</button>
    </div>

    <div id="result"></div>

    <div id="uploads">
      <input id="nftUpload" type="file" accept="image/*" multiple />
      <p>Upload your NFTs to include them on the reels.</p>
      <div id="nftPreview"></div>
    </div>

    <div id="leaderboard">
      <h2>üèÜ Leaderboard</h2>
      <ul id="lbList"></ul>
    </div>
  </main>

  <canvas id="confettiCanvas"></canvas>

  <footer>üí´ Play more at <a href="https://metawin.com" target="_blank">MetaWin</a></footer>

<script>
/* -------------------------
   Symbols and state
------------------------- */
const emojiSymbols = ["üçí","üíé","7Ô∏è‚É£","üçÄ","‚≠ê","üçä","üí∞"];
let combinedSymbols = emojiSymbols.map(s => ({type:'emoji', v:s}));
let credits = 100;
let muted = false;
const reels = [document.getElementById('r0'), document.getElementById('r1'), document.getElementById('r2')];
const creditEl = document.getElementById('creditValue');
const resultEl = document.getElementById('result');

/* -------------------------
   Fixed Sound System
------------------------- */
let audioCtx;
let buffers = {};
const soundFiles = {
  spin: "https://assets.mixkit.co/sfx/preview/mixkit-casino-slot-machine-spinning-1935.mp3",
  win: "https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"
};
async function loadSound(name, url){
  const res = await fetch(url);
  const buf = await res.arrayBuffer();
  buffers[name] = await audioCtx.decodeAudioData(buf);
}
async function initAudio(){
  if(!audioCtx){
    audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    await Promise.all(Object.entries(soundFiles).map(([n,u])=>loadSound(n,u)));
  }
}
function playSound(name){
  if(muted || !buffers[name]) return;
  const src = audioCtx.createBufferSource();
  src.buffer = buffers[name];
  src.connect(audioCtx.destination);
  src.start(0);
}
["click","keydown","touchstart"].forEach(evt =>
  window.addEventListener(evt, ()=>initAudio(), { once:true })
);

/* -------------------------
   Reel Logic
------------------------- */
function setReel(reel, token){
  reel.innerHTML = token.type==='img' ? `<img src="${token.v}">` : token.v;
}
function randomToken(){ return combinedSymbols[Math.floor(Math.random()*combinedSymbols.length)]; }
function spinReel(reel, final, steps=25){
  return new Promise(resolve=>{
    let i=0;
    reel.classList.add('spinning');
    function tick(){
      setReel(reel, randomToken());
      i++;
      if(i>=steps){
        setTimeout(()=>{
          setReel(reel, final);
          reel.classList.remove('spinning');
          resolve(final);
        },200);
      } else {
        setTimeout(tick,60 + i*2);
      }
    }
    tick();
  });
}

/* -------------------------
   Game Actions
------------------------- */
async function spin(){
  if(credits<=0){ resultEl.textContent="No credits left!"; return; }
  credits--; creditEl.textContent=credits;
  resultEl.textContent="Spinning...";
  playSound("spin");

  const finals = [randomToken(),randomToken(),randomToken()];
  const [r0,r1,r2] = await Promise.all([
    spinReel(reels[0], finals[0], 25),
    spinReel(reels[1], finals[1], 30),
    spinReel(reels[2], finals[2], 35)
  ]);

  const v0=r0.type+'|'+r0.v, v1=r1.type+'|'+r1.v, v2=r2.type+'|'+r2.v;
  if(v0===v1 && v1===v2){
    resultEl.textContent="üéâ JACKPOT! +50 credits!";
    credits+=50; creditEl.textContent=credits;
    playSound("win");
    launchConfetti();
  } else {
    resultEl.textContent="Try again!";
  }
}
document.getElementById("spin").onclick=spin;
document.getElementById("addCredit").onclick=()=>{credits+=10;creditEl.textContent=credits;};
document.getElementById("mute").onclick=()=>{muted=!muted;document.getElementById("mute").textContent=muted?"üîá Muted":"üîä Sound";};

/* Splash */
document.getElementById("enterGame").onclick=()=>{document.getElementById("splash").style.display="none";};

/* Upload NFTs */
document.getElementById("nftUpload").addEventListener("change", async ev=>{
  const files=[...ev.target.files];
  for(const f of files){
    const url=URL.createObjectURL(f);
    combinedSymbols.push({type:"img", v:url});
    const img=document.createElement("img"); img.src=url; document.getElementById("nftPreview").appendChild(img);
  }
});

/* Confetti */
function launchConfetti(){
  const canvas=document.getElementById("confettiCanvas");
  const ctx=canvas.getContext("2d");
  canvas.width=innerWidth; canvas.height=innerHeight;
  const pieces=Array.from({length:120},()=>({
    x:Math.random()*canvas.width,y:Math.random()*canvas.height- canvas.height,
    r:Math.random()*6+4,speed:Math.random()*3+2,
    color:`hsl(${Math.random()*360},100%,50%)`
  }));
  let frame=0;
  function loop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(const p of pieces){
      p.y+=p.speed; if(p.y>canvas.height) p.y=0;
      ctx.fillStyle=p.color; ctx.fillRect(p.x,p.y,p.r,p.r*0.6);
    }
    if(frame++<220) requestAnimationFrame(loop);
    else ctx.clearRect(0,0,canvas.width,canvas.height);
  }
  loop();
}
</script>
</body>
</html>
